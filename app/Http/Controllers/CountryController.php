<?php

namespace App\Http\Controllers;

use Aloha\Twilio\Twilio;
use Twilio\Rest\Client;
use App\Mail\RegistrationConfirmation;
use App\Models\PhoneBook;
use App\Models\User;
use App\Models\UserCountry;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Mail;


class CountryController extends Controller
{
    public $emojiToCode = [
        'ðŸ‡§ðŸ‡³' => 'BN',
        'ðŸ‡µðŸ‡¸' => 'PS',
        'ðŸ‡§ðŸ‡§' => 'BB',
        'ðŸ‡·ðŸ‡º' => 'RU',
        'ðŸ‡³ðŸ‡¨' => 'NC',
        'ðŸ‡¹ðŸ‡·' => 'TR',
        'ðŸ‡¨ðŸ‡³' => 'CN',
        'ðŸ‡©ðŸ‡°' => 'DK',
        'ðŸ‡­ðŸ‡·' => 'HR',
        'ðŸ‡¨ðŸ‡¦' => 'CA',
        'ðŸ‡¸ðŸ‡¾' => 'SY',
        'ðŸ‡·ðŸ‡¼' => 'RW',
        'ðŸ‡²ðŸ‡·' => 'MR',
        'ðŸ‡µðŸ‡·' => 'PR',
        'ðŸ‡³ðŸ‡®' => 'NI',
        'ðŸ‡¨ðŸ‡¬' => 'CG',
        'ðŸ‡®ðŸ‡¹' => 'IT',
        'ðŸ‡¸ðŸ‡´' => 'SO',
        'ðŸ‡¬ðŸ‡¾' => 'GY',
        'ðŸ‡µðŸ‡¾' => 'PY',
        'ðŸ‡¹ðŸ‡¯' => 'TJ',
        'ðŸ‡®ðŸ‡³' => 'IN',
        'ðŸ‡²ðŸ‡²' => 'MM',
        'ðŸ‡¶ðŸ‡¦' => 'QA',
        'ðŸ‡«ðŸ‡²' => 'FM',
        'ðŸ‡­ðŸ‡³' => 'HN',
        'ðŸ‡ªðŸ‡·' => 'ER',
        'ðŸ‡¸ðŸ‡¬' => 'SG',
        'ðŸ‡³ðŸ‡ª' => 'NE',
        'ðŸ‡­ðŸ‡º' => 'HU',
        'ðŸ‡²ðŸ‡«' => 'MF',
        'ðŸ‡³ðŸ‡·' => 'NR',
        'ðŸ‡²ðŸ‡ª' => 'ME',
        'ðŸ‡¿ðŸ‡¼' => 'ZW',
        'ðŸ‡­ðŸ‡°' => 'HK',
        'ðŸ‡«ðŸ‡¯' => 'FJ',
        'ðŸ‡§ðŸ‡¸' => 'BS',
        'ðŸ‡§ðŸ‡´' => 'BO',
        'ðŸ‡¨ðŸ‡­' => 'CH',
        'ðŸ‡¸ðŸ‡¿' => 'SZ',
        'ðŸ‡»ðŸ‡¦' => 'VA',
        'ðŸ‡¸ðŸ‡³' => 'SN',
        'ðŸ‡ºðŸ‡¦' => 'UA',
        'ðŸ‡¹ðŸ‡¨' => 'TC',
        'ðŸ‡¨ðŸ‡»' => 'CV',
        'ðŸ‡§ðŸ‡±' => 'BL',
        'ðŸ‡¦ðŸ‡«' => 'AF',
        'ðŸ‡§ðŸ‡¬' => 'BG',
        'ðŸ‡¸ðŸ‡¸' => 'SS',
        'ðŸ‡¸ðŸ‡­' => 'SH',
        'ðŸ‡µðŸ‡³' => 'PN',
        'ðŸ‡¨ðŸ‡º' => 'CU',
        'ðŸ‡±ðŸ‡¾' => 'LY',
        'ðŸ‡¯ðŸ‡µ' => 'JP',
        'ðŸ‡¹ðŸ‡¹' => 'TT',
        'ðŸ‡®ðŸ‡²' => 'IM',
        'ðŸ‡¯ðŸ‡ª' => 'JE',
        'ðŸ‡µðŸ‡¼' => 'PW',
        'ðŸ‡¸ðŸ‡¯' => 'SJ',
        'ðŸ‡²ðŸ‡¬' => 'MG',
        'ðŸ‡³ðŸ‡±' => 'NL',
        'ðŸ‡¬ðŸ‡¸' => 'GS',
        'ðŸ‡¦ðŸ‡ª' => 'AE',
        'ðŸ‡¨ðŸ‡«' => 'CF',
        'ðŸ‡¸ðŸ‡°' => 'SK',
        'ðŸ‡©ðŸ‡´' => 'DO',
        'ðŸ‡²ðŸ‡½' => 'MX',
        'ðŸ‡µðŸ‡«' => 'PF',
        'ðŸ‡©ðŸ‡¯' => 'DJ',
        'ðŸ‡²ðŸ‡¿' => 'MZ',
        'ðŸ‡¯ðŸ‡´' => 'JO',
        'ðŸ‡ªðŸ‡¹' => 'ET',
        'ðŸ‡¬ðŸ‡¬' => 'GG',
        'ðŸ‡§ðŸ‡©' => 'BD',
        'ðŸ‡µðŸ‡±' => 'PL',
        'ðŸ‡©ðŸ‡ª' => 'DE',
        'ðŸ‡±ðŸ‡·' => 'LR',
        'ðŸ‡¬ðŸ‡²' => 'GM',
        'ðŸ‡¬ðŸ‡§' => 'GB',
        'ðŸ‡±ðŸ‡»' => 'LV',
        'ðŸ‡ªðŸ‡¸' => 'ES',
        'ðŸ‡©ðŸ‡¿' => 'DZ',
        'ðŸ‡§ðŸ‡¾' => 'BY',
        'ðŸ‡«ðŸ‡®' => 'FI',
        'ðŸ‡¦ðŸ‡¿' => 'AZ',
        'ðŸ‡¬ðŸ‡µ' => 'GP',
        'ðŸ‡»ðŸ‡ª' => 'VE',
        'ðŸ‡¹ðŸ‡«' => 'TF',
        'ðŸ‡¬ðŸ‡¦' => 'GA',
        'ðŸ‡¹ðŸ‡¬' => 'TG',
        'ðŸ‡¦ðŸ‡¸' => 'AS',
        'ðŸ‡»ðŸ‡®' => 'VI',
        'ðŸ‡±ðŸ‡°' => 'LK',
        'ðŸ‡¦ðŸ‡¹' => 'AT',
        'ðŸ‡°ðŸ‡·' => 'KR',
        'ðŸ‡¬ðŸ‡¹' => 'GT',
        'ðŸ‡®ðŸ‡±' => 'IL',
        'ðŸ‡¼ðŸ‡¸' => 'WS',
        'ðŸ‡²ðŸ‡¸' => 'MS',
        'ðŸ‡²ðŸ‡µ' => 'MP',
        'ðŸ‡¨ðŸ‡¨' => 'CC',
        'ðŸ‡¹ðŸ‡³' => 'TN',
        'ðŸ‡±ðŸ‡¸' => 'LS',
        'ðŸ‡·ðŸ‡¸' => 'RS',
        'ðŸ‡°ðŸ‡¾' => 'KY',
        'ðŸ‡§ðŸ‡¿' => 'BZ',
        'ðŸ‡¨ðŸ‡¾' => 'CY',
        'ðŸ‡¬ðŸ‡±' => 'GL',
        'ðŸ‡·ðŸ‡´' => 'RO',
        'ðŸ‡­ðŸ‡¹' => 'HT',
        'ðŸ‡¬ðŸ‡©' => 'GD',
        'ðŸ‡²ðŸ‡¼' => 'MW',
        'ðŸ‡µðŸ‡¹' => 'PT',
        'ðŸ‡¨ðŸ‡¼' => 'CW',
        'ðŸ‡§ðŸ‡·' => 'BR',
        'ðŸ‡¹ðŸ‡­' => 'TH',
        'ðŸ‡²ðŸ‡±' => 'ML',
        'ðŸ‡¹ðŸ‡±' => 'TL',
        'ðŸ‡ªðŸ‡¨' => 'EC',
        'ðŸ‡²ðŸ‡³' => 'MN',
        'ðŸ‡§ðŸ‡²' => 'BM',
        'ðŸ‡¦ðŸ‡º' => 'AU',
        'ðŸ‡®ðŸ‡´' => 'IO',
        'ðŸ‡«ðŸ‡°' => 'FK',
        'ðŸ‡¼ðŸ‡«' => 'WF',
        'ðŸ‡¸ðŸ‡²' => 'SM',
        'ðŸ‡®ðŸ‡¸' => 'IS',
        'ðŸ‡¦ðŸ‡´' => 'AO',
        'ðŸ‡¬ðŸ‡·' => 'GR',
        'ðŸ‡±ðŸ‡¹' => 'LT',
        'ðŸ‡µðŸ‡²' => 'PM',
        'ðŸ‡¬ðŸ‡®' => 'GI',
        'ðŸ‡µðŸ‡¬' => 'PG',
        'ðŸ‡ºðŸ‡¿' => 'UZ',
        'ðŸ‡¹ðŸ‡²' => 'TM',
        'ðŸ‡¸ðŸ‡½' => 'SX',
        'ðŸ‡¾ðŸ‡ª' => 'YE',
        'ðŸ‡³ðŸ‡¬' => 'NG',
        'ðŸ‡¸ðŸ‡±' => 'SL',
        'ðŸ‡§ðŸ‡¼' => 'BW',
        'ðŸ‡¬ðŸ‡ª' => 'GE',
        'ðŸ‡§ðŸ‡¯' => 'BJ',
        'ðŸ‡¦ðŸ‡½' => 'AX',
        'ðŸ‡¨ðŸ‡®' => 'CI',
        'ðŸ‡ªðŸ‡­' => 'EH',
        'ðŸ‡°ðŸ‡µ' => 'KP',
        'ðŸ‡²ðŸ‡´' => 'MO',
        'ðŸ‡¨ðŸ‡´' => 'CO',
        'ðŸ‡¸ðŸ‡¹' => 'ST',
        'ðŸ‡ªðŸ‡ª' => 'EE',
        'ðŸ‡¾ðŸ‡¹' => 'YT',
        'ðŸ‡²ðŸ‡¶' => 'MQ',
        'ðŸ‡¹ðŸ‡¿' => 'TZ',
        'ðŸ‡©ðŸ‡²' => 'DM',
        'ðŸ‡¯ðŸ‡²' => 'JM',
        'ðŸ‡¸ðŸ‡®' => 'SI',
        'ðŸ‡¿ðŸ‡¦' => 'ZA',
        'ðŸ‡¬ðŸ‡¶' => 'GQ',
        'ðŸ‡¬ðŸ‡³' => 'GN',
        'ðŸ‡ºðŸ‡¬' => 'UG',
        'ðŸ‡°ðŸ‡­' => 'KH',
        'ðŸ‡¸ðŸ‡»' => 'SV',
        'ðŸ‡§ðŸ‡ª' => 'BE',
        'ðŸ‡»ðŸ‡¬' => 'VG',
        'ðŸ‡ºðŸ‡¸' => 'US',
        'ðŸ‡°ðŸ‡²' => 'KM',
        'ðŸ‡«ðŸ‡´' => 'FO',
        'ðŸ‡§ðŸ‡¶' => 'BQ',
        'ðŸ‡¨ðŸ‡·' => 'CR',
        'ðŸ‡³ðŸ‡«' => 'NF',
        'ðŸ‡°ðŸ‡ª' => 'KE',
        'ðŸ‡»ðŸ‡º' => 'VU',
        'ðŸ‡¸ðŸ‡·' => 'SR',
        'ðŸ‡²ðŸ‡©' => 'MD',
        'ðŸ‡¬ðŸ‡­' => 'GH',
        'ðŸ‡²ðŸ‡»' => 'MV',
        'ðŸ‡ªðŸ‡¬' => 'EG',
        'ðŸ‡®ðŸ‡ª' => 'IE',
        'ðŸ‡½ðŸ‡°' => 'XK',
        'ðŸ‡¨ðŸ‡±' => 'CL',
        'ðŸ‡°ðŸ‡®' => 'KI',
        'ðŸ‡²ðŸ‡¨' => 'MC',
        'ðŸ‡®ðŸ‡¶' => 'IQ',
        'ðŸ‡§ðŸ‡«' => 'BF',
        'ðŸ‡³ðŸ‡µ' => 'NP',
        'ðŸ‡´ðŸ‡²' => 'OM',
        'ðŸ‡°ðŸ‡¼' => 'KW',
        'ðŸ‡µðŸ‡­' => 'PH',
        'ðŸ‡°ðŸ‡³' => 'KN',
        'ðŸ‡°ðŸ‡¬' => 'KG',
        'ðŸ‡²ðŸ‡º' => 'MU',
        'ðŸ‡¨ðŸ‡½' => 'CX',
        'ðŸ‡§ðŸ‡»' => 'BV',
        'ðŸ‡ºðŸ‡¾' => 'UY',
        'ðŸ‡®ðŸ‡·' => 'IR',
        'ðŸ‡±ðŸ‡§' => 'LB',
        'ðŸ‡¹ðŸ‡»' => 'TV',
        'ðŸ‡°ðŸ‡¿' => 'KZ',
        'ðŸ‡¨ðŸ‡°' => 'CK',
        'ðŸ‡²ðŸ‡¾' => 'MY',
        'ðŸ‡ºðŸ‡²' => 'UM',
        'ðŸ‡«ðŸ‡·' => 'FR',
        'ðŸ‡»ðŸ‡¨' => 'VC',
        'ðŸ‡³ðŸ‡º' => 'NU',
        'ðŸ‡±ðŸ‡¦' => 'LA',
        'ðŸ‡²ðŸ‡¹' => 'MT',
        'ðŸ‡¨ðŸ‡©' => 'CD',
        'ðŸ‡¦ðŸ‡¼' => 'AW',
        'ðŸ‡µðŸ‡¦' => 'PA',
        'ðŸ‡¹ðŸ‡©' => 'TD',
        'ðŸ‡¸ðŸ‡ª' => 'SE',
        'ðŸ‡®ðŸ‡©' => 'ID',
        'ðŸ‡³ðŸ‡´' => 'NO',
        'ðŸ‡±ðŸ‡¨' => 'LC',
        'ðŸ‡¹ðŸ‡°' => 'TK',
        'ðŸ‡¦ðŸ‡¬' => 'AG',
        'ðŸ‡±ðŸ‡®' => 'LI',
        'ðŸ‡¸ðŸ‡¨' => 'SC',
        'ðŸ‡³ðŸ‡¦' => 'NA',
        'ðŸ‡·ðŸ‡ª' => 'RE',
        'ðŸ‡§ðŸ‡­' => 'BH',
        'ðŸ‡¬ðŸ‡«' => 'GF',
        'ðŸ‡¦ðŸ‡·' => 'AR',
        'ðŸ‡²ðŸ‡¦' => 'MA',
        'ðŸ‡¹ðŸ‡¼' => 'TW',
        'ðŸ‡¹ðŸ‡´' => 'TO',
        'ðŸ‡§ðŸ‡¦' => 'BA',
        'ðŸ‡¦ðŸ‡©' => 'AD',
        'ðŸ‡µðŸ‡°' => 'PK',
        'ðŸ‡¿ðŸ‡²' => 'ZM',
        'ðŸ‡¬ðŸ‡¼' => 'GW',
        'ðŸ‡¬ðŸ‡º' => 'GU',
        'ðŸ‡¸ðŸ‡¦' => 'SA',
        'ðŸ‡¨ðŸ‡¿' => 'CZ',
        'ðŸ‡¦ðŸ‡²' => 'AM',
        'ðŸ‡»ðŸ‡³' => 'VN',
        'ðŸ‡¦ðŸ‡±' => 'AL',
        'ðŸ‡µðŸ‡ª' => 'PE',
        'ðŸ‡¸ðŸ‡©' => 'SD',
        'ðŸ‡¸ðŸ‡§' => 'SB',
        'ðŸ‡¨ðŸ‡²' => 'CM',
        'ðŸ‡±ðŸ‡º' => 'LU',
        'ðŸ‡¦ðŸ‡®' => 'AI',
        'ðŸ‡²ðŸ‡­' => 'MH',
        'ðŸ‡²ðŸ‡°' => 'MK',
        'ðŸ‡§ðŸ‡¹' => 'BT',
        'ðŸ‡§ðŸ‡®' => 'BI',
        'ðŸ‡³ðŸ‡¿' => 'NZ'
    ];

    public function getCountries(): \Illuminate\Http\JsonResponse
    {
        $countriesJson = file_get_contents(public_path('data/countries.json'));

        $countries = json_decode($countriesJson, true);

        foreach ($countries as &$country) {
            $flag = $country['flag'];
            if (array_key_exists($flag, $this->emojiToCode)) {
                $country['flag'] = $this->emojiToCode[$flag];
            } else {
                $country['flag'] = 'BN';
            }
        }

        return response()->json($countries);
    }

//    public function registerUser(Request $request): string
//    {
//        DB::beginTransaction();
//
//        try {
//            $user = User::create([
//                'name' => $request->fullName,
//                'email' => $request->email,
//            ]);
//
//            if (!empty($request->selectedCountry)) {
//                UserCountry::create([
//                    'user_id' => $user->id,
//                    'country' => $request->selectedCountry,
//                ]);
//            }
//
//            if (!empty($request->phoneNumber)) {
//                PhoneBook::create([
//                    'user_id' => $user->id,
//                    'phone_number' => $request->phoneNumber,
//                ]);
//            }
//
//            DB::commit();
//
//            Mail::to($request->email)->send(new RegistrationConfirmation($user));
//            $message = "Congratulation! Your registration confirmed!";
//
//
//            $account_sid ="ACa600d87e517168502c90908bdb0254a0";
//            $auth_token = "f64b72b5192f80553387ed64208d15ca";
//            $twilio_number = "+15169906171";
//
//            $client = new Client($account_sid, $auth_token);
//            $client->messages->create(
//                $request->phoneNumber,
//                array(
//                    'from' => $twilio_number,
//                    'body' => $message
//                )
//            );
//            return 'OK';
//        } catch (\Exception $e) {
//            DB::rollBack();
//            return 'Error here: ' . $e->getMessage();
//        }
//    }

//    public function getAllUsers()
//    {
//        return User::with(['userCountry', 'phoneBook'])->get();
//    }

    public function deleteUser(Request $request)
    {

    }

}
